<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=320">
        <link rel="stylesheet" media="screen, print" href="./styles/reset-min.css">
        <link rel="stylesheet" media="screen, print" href="./styles/fonts-min.css">
        <link rel="stylesheet" media="screen and (min-device-width: 481px), print" href="./styles/cg.css">
        <link rel="stylesheet" media="only screen and (max-device-width: 480px)" href="./styles/iphone.css">
        <!--[if IE]><link rel="stylesheet" media="screen, projection" href="./styles/cg.css"><![endif]-->
        <!--[if lte IE 8]><script src="./scripts/create-elements.js" type="text/javascript"></script><![endif]-->
        <title>日本語を扱う - python_basics</title>
    </head>
    <body>
        <header>
          <h1><a href="http://yono.github.com/python/python_basics/">python_basics</a></h1>
        </header>

        <nav>
            <ul>
                <li><a href="index.html">Index</a></li>
            </ul>
        </nav>

        <article>

<!-- Auto generated start -->

<h1>日本語を扱う</h1>

<p>Python で日本語を扱う際の諸注意、Tips をまとめました。</p>

<h2>ソースコード中に日本語を書く</h2>

<p>試しにコメントに日本語を使ってみましょう</p>

<pre><code>#!/usr/bin/env python

# テスト
print 'hoge'
</code></pre>

<p>実行してみましょう。</p>

<pre><code>$ python test.py
SyntaxError: Non-ASCII character '\xe3' in file test.py on line 3, 
but no encoding declared; see http://www.python.org/peps/pep-0263.html
for details
</code></pre>

<p>Python はデフォルトだとソースコード中の文字列を ascii と想定して
処理を行います。そのため、マルチバイト文字を使うとエラーが発生します。</p>

<p>ソースコードの文字コードを指定する場合は下記の通りに書きます
(UTF-8を使う場合)。</p>

<pre><code>#!/usr/bin/env python
# -*- coding: utf-8 -*-

# テスト
print 'hoge'
</code></pre>

<p>二行目に</p>

<pre><code># -*- coding: utf-8 -*-
</code></pre>

<p>と追記しました。これによって、このスクリプトが UTF-8 で書かれていることを宣言しています。</p>

<pre><code>$ python test.py
hoge
</code></pre>

<p>適切に実行されました。</p>

<h2>Unicode 文字列に変換する</h2>

<p><a href="../standard.html">文字列の節</a>で紹介したように、文字列には通常の文字列の他にUnicode 文字列があります。</p>

<p>その違いを見るために、以下のソースを実行してみましょう。</p>

<pre><code>#!/usr/bin/env python
# -*- coding: utf-8 -*-

# テスト
hoge = 'ほげ'
u_hoge = u'ほげ'
print '通常の文字列: ', len(hoge), hoge
print 'Unicode 文字列: ', len(u_hoge), u_hoge
</code></pre>

<p>実行結果は以下のようになったはずです。</p>

<pre><code>通常の文字列:  6 ほげ
Unicode 文字列:  2 ほげ
</code></pre>

<p>どちらも文字列の長さは 2 のはずですが、通常の文字列は何故か 6 と表示されています。実は通常の文字列はバイト単位でカウントされるため、このような結果になってしまいます。</p>

<p>例えばスライスの結果もおかしくなってしまいます。</p>

<pre><code>print hoge[1] ## 文字化け
print u_hoge[1] ## 「げ」が表示される
</code></pre>

<p>そのため、文字列に対して何かしらの処理を行う場合は Unicode 文字列に変換する必要があります。</p>

<p>文字列を変換する場合のメソッドをそれぞれ示します。</p>

<p><img src="https://cacoo.com/diagrams/ZTEuvTZvPtnw8fc3.png" alt="文字列の相互変換"></p>

<pre><code>&gt;&gt;&gt; hoge = 'ほげ'
&gt;&gt;&gt; u_hoge = unicode(hoge)
Traceback (most recent call last):
  File "&lt;stdin&gt;", line 1, in &lt;module&gt;
UnicodeDecodeError: 'ascii' codec can't decode byte 0xe3 in position 0: ordinal not in range(128)
 &gt;&gt;&gt; u_hoge = unicode(hoge, 'utf-8')
 &gt;&gt;&gt; u_hoge = hoge.decode('utf-8')
 &gt;&gt;&gt; hoge = u_hoge.encode('utf-8')
 &gt;&gt;&gt;
</code></pre>

<p>文字コードを指定しないと Python は ascii だと想定して変換しようとするので、
ちゃんと文字コードを指定してあげましょう。</p>

<h2>扱う文字コードを常に UTF-8 にする</h2>

<p>とは言っても、毎回文字コードを指定するのは面倒です。
そこで、Python が文字列を変換する際のデフォルト文字コードを ascii から UTF-8に置き換えましょう。</p>

<p>そこで、まずは sitecustomize.py というファイルを作成し、以下の内容を記述してください。</p>

<pre><code>#!/usr/bin/env python
# -*- coding: utf-8 -*-
import sys
sys.setdefaultencoding('utf-8')
</code></pre>

<p>次に、以下のコマンドを実行してみてください。</p>

<pre><code>python -c "from distutils.sysconfig import get_python_lib; print get_python_lib()"
</code></pre>

<p>おそらく site-packages というディレクトリの絶対パスが表示されたはずです。そのディレクトリに、先程作成した sitecustomize.py を cp してください。</p>

<p>これで、文字列を変換する際のデフォルトの文字コードが UTF-8 へと変更されました。</p>

<pre><code>&gt;&gt;&gt; hoge = 'ほげ'
&gt;&gt;&gt; u_hoge = unicode(hoge)
&gt;&gt;&gt;
</code></pre>

<p>おそらく、エラーは起こらないはずです。</p>

<p>site-packages は、サードパーティ製のライブラリが保存されるディレクトリです。何かの際に覚えておくと便利かもしれません。</p>


<!-- Auto generated end -->

        </article>

        <footer>
            <p>Copyright &#169; 2010 <a href="mailto:tomohiro.t+github@gmail.com">Tomohiro</a> All rights reserved.</p>
            <p>Powerd by <a href="http://github.com/Tomohiro/cg" title="cg - A Ruby based ContentsGenerator">cg - A Ruby based contents generator</a></p>
        </footer>
    </body>
</html>
